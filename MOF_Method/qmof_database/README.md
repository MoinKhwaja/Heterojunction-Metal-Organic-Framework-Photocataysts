# Notes
## MOF Explorer
See http://materialsproject.org/mofs for an interactive version of the QMOF Database along with additional documentation, which includes background information for how the calculations were run and information on how to properly cite this dataset.

## Pre-requisites
The instructions for handling the JSON files below assume you have Python installed. If you don't have Python, we recommend installing it via [Anaconda](https://www.anaconda.com). Pymatgen must also be installed, which can be done via `pip install pymatgen` in the command line.

# File Descriptions
## Tabulated Properties
The most pertinent properties for each structure are stored in two JSON files:
- `qmof.json`: Tabulated properties that are for the entire material, such as energies and band gaps, as well as pertinent information about the material.
- `qmof_structure_data.json`: Pymatgen structure objects containing the PBE-D3(BJ) relaxed structures, which are annotated with site-specific data, such as partial charges.

See the "Parsing the JSON Files" section below for how to parse these files.

In general, we recommend using the JSON files if you are comfortable doing so. Nonetheless, the `qmof.json` is also presented as a `qmof.csv` file, which was generated by running `python scripts/json_to_csv.py`. The `.csv` can be easier to interact with if you prefer to use spreadsheet programs like Excel.

For your convenience, we also provide the DFT-optimized structures as CIFs in a zip folder called `relaxed_structures.zip`, which was made from the `qmof_structure_data.json` file by running `python scripts/make_cifs.py`. If you are running molecular simulations and specifically want DDEC charges written to the `_atom_site_charge` flag in the CIF, set `only_ddec_charge = True` in `make_cifs.py` and run the modified script.

# Parsing the JSON Files
## Parsing and Understanding `qmof.json`
Using Python, the `qmof.json` file can be read in as follows:
```python
import json
with open('qmof.json') as f:
    qmof = json.load(f)
```
Each entry in the list `qmof` will contain a dictionary of properties for a given material. If you like to use pandas, you can convert the data to a DataFrame as follows:
```python
import pandas as pd
qmof_df = pd.json_normalize(qmof).set_index('qmof_id')
```
Having the data as a pandas DataFrame allows you to do things like `qmof_df.sort_values('info.lcd',ascending=False)` to sort entries by largest cavity diameter or `qmof_df.loc['qmof-8b5bb88']` to retrieve all the tabulated properties for the specified entry. You can also view the `qmof.json` file in a standard text editor if you wish to understand the structure of the file.

For a given entry in `qmof`, the following tabulated properties can be accessed:

`qmof_id`:
	- A unique identifier for the material (str).

`name`:
	- The internally used filename (str).

`info`:
	- `formula`: The chemical formula per unit cell (str).
	- `formula_reduced`: The reduced (i.e. empirical) formula (str).
	- `mofid`: The MOFid information.
		- `mofid`: The MOFid (str).
		- `mofkey`: The MOFkey (str)..
		- `smiles_nodes`: SMILES representation of the nodes (list of str).
		- `smiles_linkers`: SMILES representation of the linkers (list of str).
		- `smiles`: Concatenated SMILES of the nodes and linkers (str).
		- `topology`: The topology code (str).
	- `natoms`: The number of atoms per unit cell (int).
	- `pld`: The pore-limiting diameter computed using Zeo++, in Å (float).
	- `lcd`: The largest cavity diameter computed using Zeo++, in Å (float).
	- `density`: The mass-density, in g/cm^3 (float).
	- `symmetry`: The symmetry information.
		- `spacegroup_number`: The spacegroup number.
		- `spacegroup_crystal`: The crystal system.
		- `pointgroup`: The point group.
	- `synthesized`: Whether the material is from an experimental MOF database (bool).
	- `source`: The source of the initial crystal structure (str).
	- `doi`: The URL pointing to the source of the crystal structure (str).

`inputs`:
	`pbe`: Calculations carried out on PBE-D3(BJ) optimized geometries with properties presented at the PBE-D3(BJ) level of theory.
		- `theory`: Level of theory (str).
		- `pseudopotentials`: VASP 5.4 pseudopotentials used (list of str)
		- `encut`: The VASP ENCUT parameter (int).
		- `kpoints`: The k-points used in the calculation (list of ints).
		- `gamma`: If a gamma-centered k-point grid is specified in the KPOINTS file (bool).
		- `spin`: If the calculation is spin-polarized (bool).
	`hle17`: Calculations carried out on PBE-D3(BJ) optimized geometries with properties presented at the HLE17 level of theory. Only present for some materials.
		- Same as `pbe`.
	`hse06_10hf`: Calculations carried out on PBE-D3(BJ) optimized geometries with properties presented at the HSE06* level of theory. Only present for some materials.
		- Same as `pbe`.
	`hse06`: Calculations carried out on PBE-D3(BJ) optimized geometries with properties presented at the HSE06 level of theory. Only present for some materials.
		- Same as `pbe`.

`outputs`:
	`pbe`: Calculations carried out on PBE-D3(BJ) optimized geometries with properties presented at the PBE-D3(BJ) level of theory.
		- `energy_total`: The DFT-computed energy in eV (float).
		- `energy_vdw`: Only the D3(BJ) contribution to the energy in eV (float).
		- `energy_elec`: Only the electronic contribution to the energy in eV (float).
		- `net_magmom`: Absolute value of the overall magnetic moment (float).
		- `bandgap`: The band gap in eV computed from the Kohn-Sham eigenvalues (float).
		- `cbm`: The conduction band minimum in eV computed from the Kohn-Sham eigenvalues (float).
		- `vbm`: The valence band maximum in eV computed from the Kohn-Sham eigenvalues (float).
		- `directgap`: Whether the band gap is direct, as opposed to indirect (bool).
		- `bandgap_spins`: The band gap for the up- and down-spin channels (list of floats).
		- `cbm_spins`: The CBM for the up- and down-spin channels (list of floats).
		- `vbm_spins`: The VBM for the up- and down-spin channels (list of floats).
		- `directgap_spins`. Whether the band gap in the up- and down-spin channels is direct, as opposed to indirect (list of bools).
	`hle17`: Calculations carried out on PBE-D3(BJ) optimized geometries with properties presented at the HLE17 level of theory. Only present for some materials.
		- Same as `pbe`.
	`hse06_10hf`: Calculations carried out on PBE-D3(BJ) optimized geometries with properties presented at the HSE06* level of theory. Only present for some materials.
		- Same as `pbe`.
	`hse06`: Calculations carried out on PBE-D3(BJ) optimized geometries with properties presented at the HSE06 level of theory. Only present for some materials.
		- Same as `pbe`.

With the above information, you could grab the PBE-D3(BJ) energy of qmof-8b5bb88 via `qmof_df.loc['qmof-8b5bb88']['outputs.pbe.energy_total']` or the MOFkey as `qmof_df.loc['qmof-8b5bb88']['info.mofid.mofkey']`.

## Parsing and Understanding `qmof_structure_data.json`
The `qmof_structure_data.json` can be parsed in a similar way. First, we read in the JSON file:
```python
with open('qmof_structure_data.json') as f:
    struct_data = json.load(f)
```
The Pymatgen structures with site-annotated data are now stored in a dictionary format. To convert the structures to the standard object format, the following code can be run:
```python
from pymatgen.core import Structure
qmof_structs = {}
for entry in struct_data:
    qmof_structs[entry['qmof_id']] = Structure.from_dict(entry['structure'])
```
Note that the above may take a few minutes given the large amount of structure data. Once completed, every entry of `qmof_structs` will be a key-value pair of the format {'qmof_id': Pymatgen structure object}.

The Pymatgen structure object has the usual structure-wide properties, like lattice constants and cell volume. Each site in the Pymatgen structure object also contains site-specific properties, which can be obtained via `.properties`. For instance, carrying out `qmof_structs['qmof-8b5bb88'][0].properties` will list the computed properties for atom index 0 in the selected material.

In general, the list of available site-specific properties may include:
- DDEC6 sum of bond orders
- DDEC6 partial atomic charge
- CM5 partial atomic charge
- Bader partial atomic charge
- Magnetic moment (μ_B)
- DDEC6 atomic spin density
- Bader atomic spin density

# VASP Files
Interested in other VASP-computed properties? Check out the documentation made available on the MOF Explorer application of the Materials Project for more details: https://materialsproject.org/mofs.

Raw VASP files can be found at the following NOMAD repositories:
QMOF Database - PBE: https://dx.doi.org/10.17172/NOMAD/2021.10.10-1
QMOF Database - HLE17: https://dx.doi.org/10.17172/NOMAD/2021.11.17-3.
QMOF Database - HSE06*: https://dx.doi.org/10.17172/NOMAD/2021.11.17-2.
QMOF Database - HSE06: https://dx.doi.org/10.17172/NOMAD/2021.11.17-1.

# Contact
If you have any issues or questions, please feel free to contact Andrew S. Rosen at asrosen93@gmail.com.